
WITH BOM (PART#, SUBPART#, QUANTITY) AS
     (SELECT
          ROOT.PART#
        , ROOT.SUBPART#
        , ROOT.QUANTITY
        FROM PARTS ROOT
        WHERE ROOT.PART# = '01'
      UNION ALL
      SELECT
          CHILD.PART#
        , CHILD.SUBPART#
        , CHILD.QUANTITY
        FROM BOM PARENT, PARTS CHILD
        WHERE PARENT.SUBPART# = CHILD.PART#)
SELECT
    DISTINCT PART#
  , SUBPART#
  , QUANTITY
FROM BOM
ORDER BY
    PART#
  , SUBPART#
  , QUANTITY
;


WITH BOM (PART#, SUBPART#, QUANTITY) AS
     (SELECT
          ROOT.PART#
        , ROOT.SUBPART#
        , ROOT.QUANTITY
      FROM PARTS ROOT
      WHERE ROOT.PART# = '01'
      UNION ALL
      SELECT
          PARENT.PART#
        , CHILD.SUBPART#
        , PARENT.QUANTITY*CHILD.QUANTITY
      FROM
          BOM PARENT
        , PARTS CHILD
      WHERE PARENT.SUBPART# = CHILD.PART#)
SELECT
    PART#
  , SUBPART#
  , SUM(QUANTITY) AS "Total QTY Used"
FROM BOM
GROUP BY
    PART#
  , SUBPART#
ORDER BY
    PART#
  , SUBPART#
;


WITH BOM (LEVEL, PART#, SUBPART#, QUANTITY) AS
     (SELECT
          1
        , ROOT.PART#
        , ROOT.SUBPART#
        , ROOT.QUANTITY
      FROM PARTS ROOT
      WHERE ROOT.PART# = '01'
      UNION ALL
      SELECT
          PARENT.LEVEL+1
        , CHILD.PART#
        , CHILD.SUBPART#
        , CHILD.QUANTITY
      FROM BOM PARENT, PARTS CHILD
      WHERE PARENT.SUBPART# = CHILD.PART#
        AND PARENT.LEVEL < 2)
SELECT
    PART#
  , LEVEL
  , SUBPART#
  , QUANTITY
FROM BOM
;

