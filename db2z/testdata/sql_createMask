CREATE MASK SSN_MASK ON CITIZEN
   FOR COLUMN SSN RETURN
     CASE 
          WHEN (SECURITY_GROUP_FOR_USER(SESSION_USER) = 1)
			   THEN SSN
          WHEN (SECURITY_GROUP_FOR_USER(SESSION_USER) = 2)
               THEN 'XXX-XX-' || SUBSTR(SSN,8,4)
          ELSE NULL
     END
   ENABLE;

CREATE MASK EXCLUDE ON CITIZEN FOR COLUMN ADDRESS RETURN
    CASE
        WHEN (OPT_IN = '1') THEN ADDRESS
        WHEN (OPT_IN = '2' AND SECURITY_GROUP_FOR_USER(SESSION_USER) = 1)
             THEN ADDRESS
        ELSE NULL
    END
    ENABLE
;

CREATE MASK EXCLUDE ON CITIZEN FOR COLUMN ADDRESS RETURN
    CASE
        WHEN (OPT_IN = '1') THEN ADDRESS
        WHEN (OPT_IN = '2' AND (SELECT GROUP FROM USER_GROUP WHERE USER = SESSION_USER) = 1)
             THEN ADDRESS
        ELSE NULL
    END
    ENABLE
;


