
SELECT C1, C2, C3 FROM FINAL TABLE (
  MERGE INTO T1 AS X 
    USING (
      SELECT C1, C2, C3 FROM T2 WHERE C4 IS NULL) AS Y
    ON X.C1 = Y.C1 AND X.C2 = Y.C2 AND X.C3 = Y.C3
    WHEN MATCHED THEN
      UPDATE SET X.C4 = CURRENT TIMESTAMP
    WHEN NOT MATCHED THEN
      INSERT (C1, C2, C3) VALUES (Y.C1, Y.C2, Y.C3)
    ELSE IGNORE) AS Z;

SELECT C1, C2, C3 FROM FINAL TABLE (
    INSERT INTO T1 (C1, C2, C3) VALUES ('A', 'B', 'C')) AS Z;

SELECT C1 FROM FINAL TABLE (
    UPDATE T1 SET C1 = CURRENT TIMESTAMP WHERE C2 IS NULL);

SELECT C1 FROM OLD TABLE (
    UPDATE T1 SET C1 = CURRENT TIMESTAMP WHERE C2 IS NULL);

SELECT C1 FROM OLD TABLE (
    DELETE FROM T1 WHERE C2 IS NULL);

